<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EGRETci">
<title>Guide to EGRETci 2.0 enhancements • EGRETci</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Guide to EGRETci 2.0 enhancements">
<meta property="og:description" content="EGRETci">
<meta property="og:image" content="http://usgs-r.github.io/EGRETci/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53797708-7"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53797708-7');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://www.usgs.gov/" class="external-link"><img src="logo.png" id="logo" alt="Home" style="padding: 0px 50px 0px 0px;"></a>
    <a class="navbar-brand me-2" href="../index.html">EGRETci</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/EGRETci.html">Introduction</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function Help Pages</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/Enhancements.html">Enhancements</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/prediction.html">WRTDS Kalman Prediction Intervals</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://code.usgs.gov/water/EGRETci">
    <span class="fa fa-gitlab fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Guide to EGRETci 2.0 enhancements</h1>
                        <h4 data-toc-skip class="author">Robert M.
Hirsch and Laura De Cicco</h4>
            
            <h4 data-toc-skip class="date">2018-06-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DOI-USGS/EGRETci/blob/HEAD/vignettes/Enhancements.Rmd" class="external-link"><code>vignettes/Enhancements.Rmd</code></a></small>
      <div class="d-none name"><code>Enhancements.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette documents a set of enhancements of the
<code>EGRETci</code> software package. <code>EGRET</code> is
“Exploration and Graphics for RivEr Trend” which has been developed my
Robert M. Hirsch and Laura DeCicco of the U.S. Geological Survey. The
<code>EGRETci</code> package contains functions that can be used to
evaluate the uncertainty associated with results generated by the
<code>EGRET</code> code. This document, on the <code>EGRETci</code> 2.0
enhancements assumes that the reader already has a good understanding of
WRTDS (Weighted Regressions on Time Discharge and Season), and the
<code>EGRET</code> 2.0 package and the <code>EGRET</code> 3.0
enhancements (“Guide to EGRET 3.0 enhancements”) as well as the
documentation “Introduction to EGRET Confidence Intervals”“). The two
releases <code>EGRET</code> 3.0 and <code>EGRETci</code> 2.0 are tightly
linked in terms of naming conventions and the sharing of various objects
between them. Brief reference is made to these EGRETci functions in the
documentation of the <code>EGRET</code> 3.0 enhancements.</p>
<p>The releases of <strong>EGRET 3.0</strong> add some new flexibility
to the WRTDS method. The flexibility that the new version provides are
of two kinds. One is an ability to partition the sample data into two
periods, one before and one after, a change that happened in the
watershed that we believe to have had an important, sudden, but lasting
impact on water quality. The other is the ability to relax the
assumption of stationarity of streamflow in the flow normalization
process. As shorthand we refer to the first of these enhancements as the
“wall”, and the second as “Generalized Flow Normalization.” These are
discussed in detail in “Guide to EGRET 3.0 enhancements” and are not
repeated here.</p>
<p>This document discusses the motivations and general concepts behind
these enhancements, and then move to instructions for implementation. It
is assumed that the reader already has a good working knowledge of
<strong>WRTDS, EGRET and EGRETci</strong>. <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1752-1688.2010.00482.x" class="external-link">Hirsch,
Moyer and Archfield, 2010</a>, <a href="https://pubs.usgs.gov/tm/04/a10/" class="external-link">Hirsch and DeCicco, 2015</a>, <a href="https://www.sciencedirect.com/science/article/pii/S1364815215300220" class="external-link">Hirsch,
Archfield and DeCicco, 2015</a> and the <a href="https://usgs-r.github.io/EGRET/articles/EGRET.html" class="external-link">Introduction
to the EGRET package</a>, and <a href="https://usgs-r.github.io/EGRETci/articles/EGRETci.html" class="external-link">Introduction
to EGRET Confidence Intervals</a>.</p>
<p><strong>EGRETci 2.0</strong> is designed so that it will produce
exactly the same outputs as <strong>EGRETci 1.0</strong> version did
using the same set of commands that would have been used with one
notable exception. Previous versions of <code>EGRETci</code> did not
require a “startSeed” argument when running the confidence intervals in
parallel. The reason for the change is to assure that we can now
reproduce all bootstrapping calculations. It is important to adjust any
parallel code to include that argument as follows (specifically the
“startSeed = n” argument):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nCores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">coreOut</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">nCores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="va">repAnnual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nBoot</span>,.packages<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'EGRETci'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>   <span class="va">annualResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootAnnual.html">bootAnnual</a></span><span class="op">(</span><span class="va">eList</span>, </span>
<span>                               <span class="va">blockLength</span>,</span>
<span>                               startSeed <span class="op">=</span> <span class="va">n</span><span class="op">)</span>  </span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>    </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="problem-set-up">Problem set up<a class="anchor" aria-label="anchor" href="#problem-set-up"></a>
</h2>
<p>There are three distinct types of problem set-ups that are possible
in the new formulation and each of them has its own distinct workflow
and outputs. They are known as <em>Pairs</em>, <em>Series</em>, and
<em>Groups</em>. What do these terms mean here? <strong>Pairs</strong>
is for the comparison of any two years in the study period,
<strong>Series</strong> is to describe the entire study period to
produce graphs of the change as a function of time,
<strong>Groups</strong> is for the comparison of any two groups of
contiguous years. The appropriate use of each of these three set-ups is
described in detail in the “Guide to EGRET 3.0 enhancements.”</p>
</div>
<div class="section level2">
<h2 id="runpairsboot-the-bootstrap-uncertainty-analysis-for-runpairs-results">runPairsBoot: The bootstrap uncertainty analysis for runPairs
results<a class="anchor" aria-label="anchor" href="#runpairsboot-the-bootstrap-uncertainty-analysis-for-runpairs-results"></a>
</h2>
<p>The function that does the uncertainty analysis for determining the
change between any pair of years is called
<strong>runPairsBoot</strong>. It is very similar to the
<strong>wBT</strong> function that runs the WRTDS Bootstrap Test in
<code>EGRETci</code> 1.0. It differs from <strong>wBT</strong> in that
it runs a specific number of bootstrap replicates, unlike the
<strong>wBT</strong> approach that will stop running replicates based on
the status of the test statistics along the way.</p>
<p>The call to <strong>runPairsBoot</strong> is very simple, because it
gets virtually all of the information about how the analysis is to be
set up from information in the attributes of
<strong>pairResults</strong>. The only arguments that are required are
the <strong>eList</strong> and <strong>pairResults</strong> and three
more arguments specifically related to the bootstrap process. These are
described here:</p>
<p><strong>nBoot</strong> This is the number of bootstrap replicates to
run. It has a default value of 100. A value of 100 should give rough
approximation of the correct likelihood of the trend direction. For
example, if the bootstrap results were upwards trends in 98 of 100
replicates, then we could say that we have about 95% confidence that the
true likelihood that the trend is upwards is between 0.945 and 0.998
(rather strong evidence of an upwards trend). For purposes of a
published study going to <strong>nBoot = 500</strong> may be
appropriate. For example if we had 490 upwards trends out of 500
replicates we could say with 95% confidence that the likelihood that the
true trend is upwards is between 0.966 and 0.991. To see if it is even
worthwhile to do a large number of replicates one could use a very small
number of replicates, say <strong>nBoot = 10</strong> and if there is a
fairly even mix of increases and decreases we can dispense with the high
number of replicates and simply conclude that it is about as likely up
as it is down. In a few cases some of the bootstrap replicates have
results that do not converge and they generate an error message but no
results for that replicate. To deal with that, the function is designed
to run more replicates than <strong>nBoot</strong> but to quit when it
reaches <strong>nBoot</strong></p>
<p><strong>startSeed</strong> This is the seed for the random number
generator, which is used to create the random bootstrap replicates of
the data. It has a default value but any integer will work. Knowing the
startSeed value is vital to reproducing the results. If a different
value of startSeed is used in a later run it will produce slightly
different results, but with nBoot of 200 or more these differences
should be trivially small.</p>
<p><strong>blockLength</strong> This is the block length for the block
bootstrap resampling (see <a href="https://doi.org/10.1016/j.envsoft.2015.07.017" class="external-link">Hirsch, Archfield
and DeCicco, 2015</a> for an explanation). This argument has a default
of 200 so it shouldn’t need to be specified.</p>
<p>Here we will run a trivially small example of
<strong>runPairsBoot</strong> based on the problem set up in the second
example of runPairs in the <code>EGRET</code> 3.0 enhancements User
Guide.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pubs.usgs.gov/tm/04/a10/" class="external-link">EGRET</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://code.usgs.gov/water/EGRETci" class="external-link">EGRETci</a></span><span class="op">)</span></span>
<span><span class="va">eList</span> <span class="op">&lt;-</span> <span class="va">Choptank_eList</span></span>
<span><span class="va">pairResults2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EGRET/man/runPairs.html" class="external-link">runPairs</a></span><span class="op">(</span><span class="va">eList</span>, year1 <span class="op">=</span> <span class="fl">1985</span>, year2 <span class="op">=</span> <span class="fl">2010</span>, </span>
<span>                         windowSide <span class="op">=</span> <span class="fl">7</span>, flowBreak <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                         Q1EndDate <span class="op">=</span> <span class="st">"1995-05-31"</span>, wall <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         sample1EndDate <span class="op">=</span> <span class="st">"1995-05-31"</span>, </span>
<span>                         QStartDate <span class="op">=</span> <span class="st">"1979-10-01"</span>, </span>
<span>                         QEndDate <span class="op">=</span> <span class="st">"2010-09-30"</span>, </span>
<span>                         paStart <span class="op">=</span> <span class="fl">4</span>, paLong <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootPairOut2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runPairsBoot.html">runPairsBoot</a></span><span class="op">(</span><span class="va">eList</span>, </span>
<span>                             <span class="va">pairResults2</span>, </span>
<span>                             nBoot <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span></code></pre></div>
<pre><code>
 iBoot, xConc and xFlux 1 0.4048814 0.03866322
 iBoot, xConc and xFlux 2 0.4186308 0.04813132
 iBoot, xConc and xFlux 3 0.4114679 0.04757094
 iBoot, xConc and xFlux 4 0.4314246 0.04415677
 iBoot, xConc and xFlux 5 0.3456514 0.03323089
 iBoot, xConc and xFlux 6 0.4639338 0.04792485
 iBoot, xConc and xFlux 7 0.3480087 0.03212271
 iBoot, xConc and xFlux 8 0.3694464 0.03815445
 iBoot, xConc and xFlux 9 0.3502027 0.04509857
 iBoot, xConc and xFlux 10 0.4180412 0.04559656
   Choptank River 
   Inorganic nitrogen (nitrate and nitrite)
   Season Consisting of Apr May Jun Jul Aug 


 Change estimates are for  2010  minus  1985
 Sample data set was partitioned with a wall at  1995-05-31 



Should we reject Ho that Flow Normalized Concentration Trend = 0 ? Reject Ho
 best estimate of change in concentration is   0.412 mg/L
  Lower and Upper 90% CIs    0.346    0.464
 also 95% CIs    0.346    0.464 
 and 50% CIs    0.350    0.422
 approximate two-sided p-value for Conc      0.18
* Note p-value should be considered to be &lt; stated value
 Likelihood that Flow Normalized Concentration is trending up = 0.955  is trending down = 0.0455

Should we reject Ho that Flow Normalized Flux Trend = 0 ? Reject Ho
 best estimate of change in flux is   0.0456 10^6 kg/year
  Lower and Upper 90% CIs   0.0321   0.0481
 also 95% CIs   0.0321   0.0481 
 and 50% CIs   0.0369   0.0477
 approximate two-sided p-value for Flux      0.18
* Note p-value should be considered to be &lt; stated value
 Likelihood that Flow Normalized Flux is trending up = 0.955  is trending down = 0.0455

 Upward trend in concentration is highly likely 
 Upward trend in flux is highly likely
 Downward trend in concentration is highly unlikely 
 Downward trend in flux is highly unlikely</code></pre>
<p>The output is pretty self-explanatory and the latter part of it is
identical to the summary information provided by
<strong>wBT</strong>.</p>
<p>The object returned by <strong>runPairsBoot</strong> is virtually the
same as the <strong>eBoot</strong> object returned by
<strong>wBT</strong>. It contains the data frame called
<strong>bootOut</strong> which contains all the results of the test that
are shown in the console. One new feature here is
<strong>bootOut$nBootGood</strong>. Because there is a small chance that
the bootstrap results will contain a small number of iterations that
fail to complete it may end up with a number of valid replicates that is
less than <strong>nBoot</strong>. The number of usable replicates is
<strong>nBootGood</strong>. The other parts of the returned object are
the same as those returned from <strong>wBT</strong>.</p>
<p>One of the outputs we can use to describe the results of the test is
the histogram of percentage changes. These can be done with the
<strong>plotHistogramTrend</strong> function just as they have been in
the <code>EGRETci</code> 1.0.3 software. The only difference in the call
to the function is that we don’t use <strong>caseSetUp</strong> in
<strong>runPairs</strong> so that argument is set to <strong>caseSetUp =
NA</strong>.</p>
<p>To call this function for a runPairsBoot result would look like
this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHistogramTrend.html">plotHistogramTrend</a></span><span class="op">(</span><span class="va">eList</span>, <span class="va">eBoot</span>, caseSetUp <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                   flux <span class="op">=</span> <span class="cn">TRUE</span>, xMin <span class="op">=</span> <span class="cn">NA</span>, xMax <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                   xStep <span class="op">=</span> <span class="cn">NA</span>, printTitle <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                   cex.main <span class="op">=</span> <span class="fl">1.1</span>, cex.axis <span class="op">=</span> <span class="fl">1.1</span>, </span>
<span>                   cex.lab <span class="op">=</span> <span class="fl">1.1</span>, col.fill <span class="op">=</span> <span class="st">"grey"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>The only two arguments required are eList, and eBoot which represents
the output from runPairsBoot.</p>
<p>Here are the calls to <strong>plotHistogramTrend</strong> first for
flux, and then for concentration. [We have substituted in a set of
<strong>runPairsBoot</strong> outputs for which <strong>nBoot =
100</strong> rather than using the one shown above.]</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootPairOut2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runPairsBoot.html">runPairsBoot</a></span><span class="op">(</span><span class="va">eList</span>, <span class="va">pairResults2</span>, nBoot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Here are the calls to <strong>plotHistogramTrend</strong> first for
flux, and then for concentration.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHistogramTrend.html">plotHistogramTrend</a></span><span class="op">(</span><span class="va">eList</span>,<span class="va">bootPairOut2</span>, caseSetUp <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></code></pre></div>
<p><img src="Enhancements_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHistogramTrend.html">plotHistogramTrend</a></span><span class="op">(</span><span class="va">eList</span>,<span class="va">bootPairOut2</span>, caseSetUp <span class="op">=</span> <span class="cn">NA</span>, flux <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Enhancements_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<p>So, what the results clearly show us is that flux has clearly
increased and probably by a magnitude of a few hundred percent and
concentration has clearly increased probably by an amount between about
100 % to 200 %.</p>
</div>
<div class="section level2">
<h2 id="the-bootstrap-uncertainty-analysis-for-runseries">The bootstrap uncertainty analysis for runSeries<a class="anchor" aria-label="anchor" href="#the-bootstrap-uncertainty-analysis-for-runseries"></a>
</h2>
<p>The purpose of Series analysis is to create a time series of
flow-normalized concentrations and flow-normalized flux values. The
function that does this is <strong>runSeries in the EGRET</strong>
package.</p>
<p>In the case of <strong>runSeries</strong> we can do uncertainty
analysis which provides us with confidence intervals around the flow
normalized time series that we estimated from running the
<strong>runSeries</strong> function. In this case we actually use the
same functions that were used in EGRETci 1.0.3, but they have been
modified here to accommodate all of the flexible features of
<strong>runSeries</strong> (but they run exactly as they did before if
they were just working off of results from
<strong>modelEstimation</strong>).</p>
<p>This is how it is called:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CIAnnualResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ciCalculations.html">ciCalculations</a></span><span class="op">(</span><span class="va">eList</span>, </span>
<span>                                  startSeed <span class="op">=</span> <span class="fl">494817</span>, </span>
<span>                                  verbose <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>The eList that is passed to the function should be a version of eList
that has already been run through <strong>runSeries</strong>. So, for
the example run shown above the eList argument would be
<strong>eListOut</strong>. That version contains all the estimated
values as well as all of the arguments that were used in the computation
(related to the <strong>wall</strong> and <strong>flowBreak</strong>
etc.). There is no need to specify <strong>startSeed</strong>, the
default will be fine (unless one wants to explore how the results might
change in another run of the function). To avoid seeing all the progress
indicators on the screen one can set <strong>verbose = FALSE</strong>,
but it may be desirable just to see that the job is continuing to run by
setting <strong>verbose = TRUE</strong>. It can take a considerable
amount of computer time.</p>
<p>The <code>...</code> in the call specifically relate to some other
bootstrap-related parameters that the user might wish to set. They can
be left out of the call, and the program with interactively request the
information, or they can be set directly in the call. We will set up to
run the job specifying them without the interactive part (as would be
done in a batch implementation).</p>
<p>We will run the bootstrap analysis here. We will use the output of
the last run of <strong>runSeries</strong> example in the EGRET
enhancement vignette.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eList</span> <span class="op">&lt;-</span> <span class="va">Choptank_eList</span></span>
<span><span class="va">eListOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EGRET/man/runSeries.html" class="external-link">runSeries</a></span><span class="op">(</span><span class="va">eList</span>, windowSide <span class="op">=</span> <span class="fl">7</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">CIAnnualResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ciCalculations.html">ciCalculations</a></span><span class="op">(</span><span class="va">eListOut</span>, </span>
<span>                                  verbose <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                  nBoot <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                  blockLength <span class="op">=</span> <span class="fl">200</span>, </span>
<span>                                  widthCI <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CIAnnualResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ciCalculations.html">ciCalculations</a></span><span class="op">(</span><span class="va">eListOut</span>, </span>
<span>                                  verbose <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                  nBoot <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                  blockLength <span class="op">=</span> <span class="fl">200</span>, </span>
<span>                                  widthCI <span class="op">=</span> <span class="fl">90</span><span class="op">)</span></span></code></pre></div>
<p><strong>nBoot</strong> is the number of bootstrap replicates to be
run. A result that is suitable for publication should probably have
<strong>nBoot</strong> at least 100 and preferably 200.
<strong>blockLength</strong> is typically set to 200.
<strong>widthCI</strong> is the width of the confidence interval. If
<strong>widthCI = 90</strong> that means that the confidence intervals
that will be drawn are the 5th and 95th percentiles.</p>
<p>We can visualize the results by using the <strong>plotConcHistBoot
and plotFluxHistBoot</strong> functions (which were a part of the
EGRETci 1.0.3 code). Running them with results from
<strong>runSeries</strong> requires that we use the eList that is
produced by the <strong>runSeries</strong> function. So, following the
results we saw from <strong>runSeries</strong> we would obtain the
confidence interval plots as follows. (Note that there are several other
arguments to these functions that are the same as those used in
<strong>plotConcHist and plotFluxHist</strong>).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotConcHistBoot.html">plotConcHistBoot</a></span><span class="op">(</span><span class="va">eListOut</span>, <span class="va">CIAnnualResults</span><span class="op">)</span></span></code></pre></div>
<p><img src="Enhancements_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotFluxHistBoot.html">plotFluxHistBoot</a></span><span class="op">(</span><span class="va">eListOut</span>, <span class="va">CIAnnualResults</span><span class="op">)</span></span></code></pre></div>
<p><img src="Enhancements_files/figure-html/unnamed-chunk-11-2.png" width="672">
Looking at the output, particularly for plotFluxHistBoot, suggests that
the windowSide argument is probably too short. The plot is simply too
jagged. A better choice would probably have been to set windowSide = 11.
We have included this example here to show the problem of having
windowSide be too small. The general conclusions about the overall
increase over the more than 30 year record would remain the same and the
width of the confidence intervals wouldn’t change much if a better
windowSide argument had been used.</p>
</div>
<div class="section level2">
<h2 id="rungroupsboot-the-bootstrap-uncertainty-analysis-for-rungroups-results">runGroupsBoot: The bootstrap uncertainty analysis for runGroups
results<a class="anchor" aria-label="anchor" href="#rungroupsboot-the-bootstrap-uncertainty-analysis-for-rungroups-results"></a>
</h2>
<p>The function that does the uncertainty analysis for determining the
change between two groups of years is called
<strong>runGroupsBoot</strong>. The process is virtually identical to
what is used for <strong>runPairsBoot</strong>, so much of the detail
will be left out of this discussion. The call to
<strong>runGroupsBoot</strong> is very simple, because it gets virtually
all of the information about how the analysis is to be set up from
information in the attributes of <strong>groupResults</strong>. The only
arguments that are required are the <strong>eList</strong> and
<strong>groupResults</strong> and three more arguments specifically
related to the bootstrap process:</p>
<p><strong>nBoot</strong> This is the number of bootstrap replicates to
run. It has a default value of 100. In a few cases some of the bootstrap
replicates have results that do not converge and they generate an error
message but no results for that replicate. To deal with that the
function is designed to run more replicates than <strong>nBoot</strong>
but to quit when it reaches <strong>nBoot</strong></p>
<p><strong>startSeed</strong> This is the seed for the random number
generator, which is used to create the random bootstrap resamples of the
data. It has a default value but any integer will work.</p>
<p><strong>blockLength</strong> This is the block length for the block
bootstrap resampling. This argument has a default of 200 so it shouldn’t
need to be specified.</p>
<p>Here we will run <strong>runGroupsBoot</strong> based on the problem
set-up in the example of runGroups in the EGRET 3.0 Enhancements User
Guide.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eList</span> <span class="op">&lt;-</span> <span class="va">Choptank_eList</span></span>
<span><span class="va">groupResults</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/EGRET/man/runGroups.html" class="external-link">runGroups</a></span><span class="op">(</span><span class="va">eList</span>, </span>
<span>                          group1firstYear <span class="op">=</span> <span class="fl">1995</span>, group1lastYear <span class="op">=</span> <span class="fl">2004</span>, </span>
<span>                          group2firstYear <span class="op">=</span> <span class="fl">2005</span>, group2lastYear <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>                          windowSide <span class="op">=</span> <span class="fl">7</span>, wall <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                          sample1EndDate <span class="op">=</span> <span class="st">"2004-10-30"</span>, </span>
<span>                          paStart <span class="op">=</span> <span class="fl">4</span>, paLong <span class="op">=</span> <span class="fl">2</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">bootGroupsOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runGroupsBoot.html">runGroupsBoot</a></span><span class="op">(</span><span class="va">eList</span>, <span class="va">groupResults</span>, nBoot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code>

 iBoot, xConc and xFlux 1 0.1112342 0.00210587
 iBoot, xConc and xFlux 2 0.2313755 0.01785959
 iBoot, xConc and xFlux 3 0.1940411 0.01241572
 iBoot, xConc and xFlux 4 0.1362666 0.01586453
 ...
 iBoot, xConc and xFlux 98 0.2323236 0.02383054
 iBoot, xConc and xFlux 99 0.1258737 0.01037859
 iBoot, xConc and xFlux 100 0.2255112 0.01616338

   Choptank River 
   Inorganic nitrogen (nitrate and nitrite)
   Season Consisting of Apr May 

 Change estimates for
 average of 2005  through 2010  minus average of 1995  through 2004 

 Sample data set was partitioned with a wall at  2004-10-30 



Should we reject Ho that Flow Normalized Concentration Trend = 0 ? Reject Ho
 best estimate of change in concentration is   0.153 mg/L
  Lower and Upper 90% CIs  0.03306  0.25923
 also 95% CIs  0.00971  0.29603 
 and 50% CIs  0.09818  0.19353
 approximate two-sided p-value for Conc     0.033
 Likelihood that Flow Normalized Concentration is trending up = 0.985  is trending down = 0.0149

Should we reject Ho that Flow Normalized Flux Trend = 0 ? Do Not Reject Ho
 best estimate of change in flux is  0.00931 10^6 kg/year
  Lower and Upper 90% CIs -0.014505  0.026523
 also 95% CIs -0.017796  0.033343 
 and 50% CIs  0.000622  0.016089
 approximate two-sided p-value for Flux      0.47
 Likelihood that Flow Normalized Flux is trending up = 0.767  is trending down = 0.233

 Upward trend in concentration is highly likely 
 Upward trend in flux is likely
 Downward trend in concentration is highly unlikely 
 Downward trend in flux is unlikely
</code></pre>
<p>The output is pretty self-explanatory and virtually the same as that
which is generated by <strong>runPairsBoot</strong>.</p>
<p>The object returned by <strong>runGroupsBoot</strong> is virtually
the same as the <strong>eBoot</strong> object returned by
<strong>wBT</strong>. The object returned, called
<strong>bootGroupsOut</strong> contains all the results of the test that
are shown in the console.</p>
<p>We cam visualize the results of the test as a the histogram of
percentage changes. These can be done with the
<strong>plotHistogramTrend</strong> function.</p>
<p>To call this function for a <strong>runGroupsBoot</strong> result
would look like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHistogramTrend.html">plotHistogramTrend</a></span><span class="op">(</span><span class="va">eList</span>, <span class="va">eBoot</span>, flux <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                         xMin <span class="op">=</span> <span class="cn">NA</span>, xMax <span class="op">=</span> <span class="cn">NA</span>, xStep <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                         printTitle <span class="op">=</span> <span class="cn">TRUE</span>, cex.main <span class="op">=</span> <span class="fl">1.1</span>, </span>
<span>                         cex.axis <span class="op">=</span> <span class="fl">1.1</span>, cex.lab <span class="op">=</span> <span class="fl">1.1</span>, </span>
<span>                         col.fill <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<p>The only two arguments required are <strong>eList</strong>, and
<strong>eBoot</strong> which represents the output from
<strong>runGroupsBoot</strong>.</p>
<p>Here are the calls to <strong>plotHistogramTrend</strong> first for
flux, and then for concentration. The <strong>xMin, xMax, and
xStep</strong> arguments shown below were selected based on first
viewing the results using the default values and then searching for a
set of values for the three arguments that provided a good
representation of the distribution.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHistogramTrend.html">plotHistogramTrend</a></span><span class="op">(</span><span class="va">eList</span>, <span class="va">bootGroupsOut</span>, </span>
<span>                   xMin <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>, xMax <span class="op">=</span> <span class="fl">40</span>, xStep <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="Enhancements_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotHistogramTrend.html">plotHistogramTrend</a></span><span class="op">(</span><span class="va">eList</span>, <span class="va">bootGroupsOut</span>, </span>
<span>                   flux<span class="op">=</span><span class="cn">FALSE</span>, xMin <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>,</span>
<span>                   xMax <span class="op">=</span> <span class="fl">50</span>, xStep <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Enhancements_files/figure-html/unnamed-chunk-15-2.png" width="672"></p>
<p>What the results clearly show us is that both flux and concentration
indicate that it is somewhat more likely to have been an increase rather
than a decrease between the two groups of years. Our best estimate is an
increase is a little less than about + 10%. For both flux and
concentration the trend is fairly likely to be in the range from -20% to
about +30%.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer></footer>
</div> <!-- / div for your main content-->

<!-- BEGIN USGS Footer Template -->

<footer class="footer"><div class="tmp-container">
		<!-- .footer-wrap -->
			<!-- .footer-doi -->
			<div class="footer-doi">
				<!-- footer nav links -->
				<ul class="menu nav">
<li class="first leaf menu-links menu-level-1"><a href="https://www.doi.gov/privacy" class="external-link">DOI Privacy Policy</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/policies-and-notices" class="external-link">Legal</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/accessibility-and-us-geological-survey" class="external-link">Accessibility</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/sitemap" class="external-link">Site Map</a></li>
					<li class="last leaf menu-links menu-level-1"><a href="https://answers.usgs.gov/" class="external-link">Contact USGS</a></li>
				</ul>
<!--/ footer nav links -->
</div>
			<!-- /.footer-doi -->

			<hr>
<!-- .footer-utl-links --><div class="footer-doi">
			<ul class="menu nav">
<li class="first leaf menu-links menu-level-1"><a href="https://www.doi.gov/" class="external-link">U.S. Department of the Interior</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.doioig.gov/" class="external-link">DOI Inspector General</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.whitehouse.gov/" class="external-link">White House</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.whitehouse.gov/omb/management/egov/" class="external-link">E-gov</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.doi.gov/pmb/eeo/no-fear-act" class="external-link">No Fear Act</a></li>
				<li class="last leaf menu-links menu-level-1"><a href="https://www.usgs.gov/about/organization/science-support/foia" class="external-link">FOIA</a></li>
			</ul>
</div>			
		<!-- /.footer-utl-links -->
		<!-- .footer-social-links -->
		<div class="footer-social-links">
			<ul class="social">
<li class="follow">Follow</li>
				<li class="twitter">
					<a href="https://twitter.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-twitter-square"><span class="only">Twitter</span></i>
					</a>
				</li>
				<li class="facebook">
					<a href="https://facebook.com/usgeologicalsurvey" target="_blank" class="external-link">
						<i class="fa fa-facebook-square"><span class="only">Facebook</span></i>
					</a>
				</li>
				<li class="github">
					<a href="https://github.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-github"><span class="only">GitHub</span></i>
					</a>
				</li>
				<li class="flickr">
					<a href="https://flickr.com/usgeologicalsurvey" target="_blank" class="external-link">
						<i class="fa fa-flickr"><span class="only">Flickr</span></i>
					</a>
				</li>
				<li class="youtube">
					<a href="http://youtube.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-youtube-play"><span class="only">YouTube</span></i>
					</a>
				</li>
				<li class="instagram">
					<a href="https://instagram.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-instagram"><span class="only">Instagram</span></i>
					</a>
				</li>
			</ul>
</div>
		<!-- /.footer-social-links -->
	</div>
		<!-- /.footer-wrap -->	
</footer><!-- END USGS Footer Template- --><!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKQR8KP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  
  </body>
<!-- closing div for body -->
</html>
